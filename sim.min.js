function Opcode(){this.mnemonic=new IllustratedProperty("Nieznany","nieznany"),this.addressingMode=new IllustratedProperty("Nieznany tryb","nieznany"),this.length=0,this.firstCategory=-1,this.secondCategory=-1}function IllustratedProperty(e,t){this.name=e,this.imageName=t+".png"}function fillOpcodeMnemonics(e){for(var t=[[105,101,117,97,113,109,125,121],[41,37,53,33,49,45,61,57],[10,6,22,14,30],[144],[176],[240],[36,44],[48],[208],[16],[0],[80],[112],[24],[216],[88],[184],[201,197,213,193,209,205,221,217],[224,228,236],[192,196,204],[198,214,206,222],[202],[136],[73,69,85,65,81,77,93,89],[230,246,238,254],[232],[200],[76,108],[32],[169,165,181,161,177,173,189,185],[162,166,182,174,190],[160,164,180,172,188],[74,70,86,78,94],[234],[9,5,21,1,17,13,29,25],[72],[8],[104],[40],[42,38,54,46,62],[106,102,118,110,126],[64],[96],[233,229,245,225,241,237,253,249],[56],[248],[120],[133,149,129,145,141,157,153],[134,150,142],[132,148,140],[170],[168],[186],[138],[154],[152]],r=[new IllustratedProperty("ADC","adc"),new IllustratedProperty("AND","and"),new IllustratedProperty("ASL","asl"),new IllustratedProperty("BCC","bcc"),new IllustratedProperty("BCS","bcs"),new IllustratedProperty("BEQ","beq"),new IllustratedProperty("BIT","bit"),new IllustratedProperty("BMI","bmi"),new IllustratedProperty("BNE","bne"),new IllustratedProperty("BPL","bpl"),new IllustratedProperty("BRK","brk"),new IllustratedProperty("BVC","bvc"),new IllustratedProperty("BVS","bvs"),new IllustratedProperty("CLC","clc"),new IllustratedProperty("CLD","cld"),new IllustratedProperty("CLI","cli"),new IllustratedProperty("CLV","clv"),new IllustratedProperty("CMP","cmp"),new IllustratedProperty("CPX","cpx"),new IllustratedProperty("CPY","cpy"),new IllustratedProperty("DEC","dec"),new IllustratedProperty("DEX","dex"),new IllustratedProperty("DEY","dey"),new IllustratedProperty("EOR","eor"),new IllustratedProperty("INC","inc"),new IllustratedProperty("INX","inx"),new IllustratedProperty("INY","iny"),new IllustratedProperty("JMP","jmp"),new IllustratedProperty("JSR","jsr"),new IllustratedProperty("LDA","lda"),new IllustratedProperty("LDX","ldx"),new IllustratedProperty("LDY","ldy"),new IllustratedProperty("LSR","lsr"),new IllustratedProperty("NOP","nop"),new IllustratedProperty("ORA","ora"),new IllustratedProperty("PHA","pha"),new IllustratedProperty("PHP","php"),new IllustratedProperty("PLA","pla"),new IllustratedProperty("PLP","plp"),new IllustratedProperty("ROL","rol"),new IllustratedProperty("ROR","ror"),new IllustratedProperty("RTI","rti"),new IllustratedProperty("RTS","rts"),new IllustratedProperty("SBC","sbc"),new IllustratedProperty("SEC","sec"),new IllustratedProperty("SED","sed"),new IllustratedProperty("SEI","sei"),new IllustratedProperty("STA","sta"),new IllustratedProperty("STX","stx"),new IllustratedProperty("STY","sty"),new IllustratedProperty("TAX","tax"),new IllustratedProperty("TAY","tay"),new IllustratedProperty("TSX","tsx"),new IllustratedProperty("TXA","txa"),new IllustratedProperty("TXS","txs"),new IllustratedProperty("TYA","tya")],s=0;s<t.length;++s)for(var a=0;a<t[s].length;++a)e[t[s][a]].mnemonic=r[s]}function fillOpcodeAddressingModes(e){for(var t=[[0,64,96,72,8,104,40,24,216,88,184,202,136,232,200,234,56,248,120,170,168,186,138,154,152,10,42,74,106],[169,162,160,105,233,41,9,73,201,224,192],[32,76,173,174,172,45,13,77,109,237,205,236,204,44,14,78,46,110,238,206,141,142,140],[165,166,164,37,5,69,101,229,197,228,196,36,6,70,38,102,230,198,133,134,132],[181,180,85,53,21,117,245,213,22,86,54,118,246,214,149,148],[182,150],[125,61,30,221,222,93,254,189,188,94,29,62,126,253,157],[121,57,217,89,185,190,25,249,153],[144,176,240,48,208,16,80,112],[97,33,193,65,161,1,225,129],[113,49,209,81,177,17,241,145],[108]],r=[new IllustratedProperty("implied","implied"),new IllustratedProperty("immediate","immediate"),new IllustratedProperty("absolute","absolute"),new IllustratedProperty("zero page","zero_page"),new IllustratedProperty("zero page X","zero_page_X"),new IllustratedProperty("zero page Y","zero_page_Y"),new IllustratedProperty("absolute X","absolute_X"),new IllustratedProperty("absolute Y","absolute_Y"),new IllustratedProperty("relative","relative"),new IllustratedProperty("indirect X","indirect_X"),new IllustratedProperty("indirect Y","indirect_Y"),new IllustratedProperty("absolute indirect","absolute_indirect")],s=0;s<t.length;++s)for(var a=0;a<t[s].length;++a)e[t[s][a]].addressingMode=r[s]}function fillOpcodeCategories(e){for(var t=[[0,32,76,173,174,172,45,13,77,109,237,205,44,14,78,46,110,238,206,141,142,140,165,166,164,37,5,69,101,229,197,36,6,70,38,102,230,198,133,134,132,181,180,85,53,21,117,245,213,22,86,54,118,246,214,149,148,182,150,189,188,93,61,29,125,253,221,30,94,62,126,254,222,157,185,190,89,57,25,121,249,217,153,161,1,65,33,97,193,225,129,177,81,49,17,113,241,209,145,108],[248,234,232,216,202,200,186,184,170,168,154,152,138,136,120,88,56,24,106,74,42,10],[169,162,160,105,233,41,9,73,201,224,192],[144,176,208,240,16,48,80,112]],r=[[173,174,172,45,13,77,109,237,205,236,204,44],[14,78,46,110,238,206],[141,142,140],[165,166,164,37,5,69,101,229,197,228,196,36],[6,70,38,102,230,198],[133,134,132],[181,180,85,53,21,117,245,213],[22,86,54,118,246,214],[149,148],[182],[150],[29,30,61,62,93,94,125,126,157,188,189,221,222,253,254],[30,94,62,126,254,222],[157],[185,190,89,57,25,121,249,217],[153],[144,176,208,240,16,48,80,112],[161,1,65,33,97,193,225],[129],[177,81,49,17,113,241,209],[145],[108]],s=0;s<t.length;++s)for(var a=0;a<t[s].length;++a)e[t[s][a]].firstCategory=s;for(s=0;s<r.length;++s)for(a=0;a<r[s].length;++a)e[r[s][a]].secondCategory=s}function fillOpcodeLengths(e){for(var t=[[0,64,96,72,8,104,40,24,216,88,184,202,136,232,200,234,56,248,120,170,168,186,138,154,152,10,42,74,106],[169,162,160,105,233,41,9,73,201,224,192,165,166,164,37,5,69,101,229,197,228,196,36,6,70,38,102,230,198,133,134,132,181,180,85,53,21,117,245,213,22,86,54,118,246,214,149,148,182,150,144,176,240,48,208,16,80,112,97,33,193,65,161,1,225,129,113,49,209,81,177,17,241,145],[32,76,173,174,172,45,13,77,109,237,205,236,204,44,14,78,46,110,238,206,141,142,140,125,61,30,221,222,93,254,189,188,94,29,62,126,253,157,121,57,217,89,185,190,25,249,153,108]],r=0;r<t.length;++r)for(var s=0;s<t[r].length;++s)e[t[r][s]].length=r+1}function val8(e){return 255&e}function val16(e){return 65535&e}function u2_8BitNumber(e){return e>127?e-256:e}function fillTable(e,t){$("#ram-cells").html('<tr><td class="ram-col"></td><td class="ram-col">$0</td><td class="ram-col">$1</td><td class="ram-col">$2</td><td class="ram-col">$3</td><td class="ram-col">$4</td><td class="ram-col">$5</td><td class="ram-col">$6</td><td class="ram-col">$7</td><td class="ram-col">$8</td><td class="ram-col">$9</td><td class="ram-col">$A</td><td class="ram-col">$B</td><td class="ram-col">$C</td><td class="ram-col">$D</td><td class="ram-col">$E</td><td class="ram-col">$F</td></tr>');var r=0,s="";for(i=e;i<=t;i+=16){for(s+='<tr><td class="rownum">$'+addLeadingZeros(i.toString(16),4)+"</td>",j=0;j<=15;++j,++r)s+='<td id="cell'+String(i+j)+'" title="$'+addLeadingZeros((i+j).toString(16),4).toUpperCase()+'">$'+addLeadingZeros(cpu.mem[i+j].toString(16),2)+"</td>";s+="</tr>"}$("#ram-cells").append(s),$("td[id^='cell']").dblclick(userInterface.CellEditor.editCell),$("#loading-icon").remove(),reactions.highlightEICAgain(),reactions.highlightComponents()}function renderConsole(){var e=$("#console-cells"),t=new String,r=0;for(i=0;i<8;i++){for(t+="<tr>",j=0;j<32;j++,r++)t+='<td id="console-cell'+r+'"></td>';t+="</tr>"}e.html(t)}function newInputStr(e){return'<input type="text" id="inp'+e+'"/>'}function init(){memory.init(),cpuShapes.initShapes(),$("#switch-light-button").click(additionalUtils.switchBackground),$("#load-button").click(userInterface.SourceCodeEditor.processCode),$("#start-button").click(ProgramControl.start),$("#continue-button").click(ProgramControl.continueProgram),$("#step-button").click(ProgramControl.step),$("#pc-update-button").click(userInterface.updateProgramCounter),$("#ram-table-refresh-button").click(userInterface.refreshRamTable),$(".code-tabs li").click(function(e){let t=$(this).index();switch($(".code-tabs li").removeClass("active"),$(this).addClass("active"),t){case 0:$("#code-edit-sec").show(),$("#code-debug-sec").hide();break;case 1:$("#code-debug-sec").show(),$("#code-edit-sec").hide()}}),null!==localStorage.getItem("asm-code")&&$("#source-code").val(localStorage.getItem("asm-code")),cpu.initializeMemory(65536),fillTable(0,255),renderConsole(),ModalManager.prepareBeginnerMessage()}function addLeadingZeros(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r}var simConsole={glyphs:[" ","&spades;","&clubs;","&hearts;","&diams;","&EmptySmallSquare;","&FilledSmallSquare;","&starf;","&star;","&phone;","&female;","&male;","&check;","&cross;","&sext;","&#10052;","&#10063;","&#10051;","&#10086;","&#10087;","&#10209;","&#10856;","&#11039;","&#11040;","&#11041;","&#11042;","&#11043;","&#10856;","&#10042;","&#10026;","&#10050;","&#10048;"," ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","Ą","ą","Ć","ć","Ę","ę","Ł","ł","Ń","ń","Ó","ó","Ś","ś","Ź","ź","Ż","ż","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&Dot;","&copy;","&laquo;","&not;","&reg;","&macr;","&deg;","&plusmn;","&ordm;","&sup1;","&sup2;","&sup3;","&para;","&middot;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&times;","&divide;","&dagger;","&ddagger;","&nldr;","&hellip;","&euro;","&numero;","&boxh;","&boxv;","&boxdr;","&boxdl;","&boxur;","&boxul;","&boxvr;","&boxvl;","&boxhd;","&boxhu;","&boxvh;","&boxH;","&boxV;","&boxdR;","&boxDr;","&boxDR;","&boxdL;","&boxDl;","&boxDL;","&boxuR;","&boxUr;","&boxUR;","&boxuL;","&boxUl;","&boxUL;","&boxvR;","&boxVr;","&boxVR;","&boxvL;","&boxVl;","&boxVL;","&boxHd;","&boxhD;","&boxHD;","&boxHu;","&boxhU;","&boxHU;","&boxvH;","&boxVh;","&boxVH;","&uhblk;","&lhblk;","&block;","&blk14;","&blk12;","&blk34;","&#10226;","&#10227;","&#11034;","&empty;","&#10192;","&#10193;","&#10194;","&#10195;","&#10196;","&#10207;","&#10208;","&#10214;","&#10215;","&#11000;","&#9874;","&#9872;","&#9873;","&#9850;","&#9786;","&#9787;","&#9774;","&#9775;","&#9762;","&#9187;","&#9004;","&#8258;","&Otimes;","&xodot;","&malt;","&phone;","&#40863;"],colors:["black","navy","green","teal","maroon","purple","olive","silver","gray","blue","lime","aqua","red","fuchsia","yellow","white"],updateConsole(e,t){var r=Math.trunc((e-1536)/2),s=$("#console-cell"+r);if(e%2==0)s.html(this.glyphs[t]);else{var a=15&t,c=(240&t)>>4;s.css("background",this.colors[c]),s.css("color",this.colors[a])}}},assembler={instructionSet:{ADC:{immediate:105,zeroPage:101,zeroPageX:117,absolute:109,absoluteX:125,absoluteY:121,indirectX:97,indirectY:113},AND:{immediate:41,zeroPage:37,zeroPageX:53,absolute:45,absoluteX:61,absoluteY:57,indirectX:33,indirectY:49},ASL:{implied:10,zeroPage:6,zeroPageX:22,absolute:14,absoluteX:30},BIT:{zeroPage:36,absolute:44},BPL:{relative:16},BMI:{relative:48},BVC:{relative:80},BVS:{relative:112},BCC:{relative:144},BCS:{relative:176},BNE:{relative:208},BEQ:{relative:240},BRK:{implied:0},CMP:{immediate:201,zeroPage:197,zeroPageX:213,absolute:205,absoluteX:221,absoluteY:217,indirectX:193,indirectY:209},CPX:{immediate:224,zeroPage:228,absolute:236},CPY:{immediate:192,zeroPage:196,absolute:204},DEC:{zeroPage:198,zeroPageX:214,absolute:206,absoluteX:222},EOR:{immediate:73,zeroPage:69,zeroPageX:85,absolute:77,absoluteX:93,absoluteY:89,indirectX:65,indirectY:81},CLC:{implied:24},SEC:{implied:56},CLI:{implied:88},SEI:{implied:120},CLV:{implied:184},CLD:{implied:216},SED:{implied:248},INC:{zeroPage:230,zeroPageX:246,absolute:238,absoluteX:254},JMP:{absolute:76,indirect:108},JSR:{absolute:32},LDA:{immediate:169,zeroPage:165,zeroPageX:181,absolute:173,absoluteX:189,absoluteY:185,indirectX:161,indirectY:177},LDX:{immediate:162,zeroPage:166,zeroPageY:182,absolute:174,absoluteY:190},LDY:{immediate:160,zeroPage:164,zeroPageX:180,absolute:172,absoluteX:188},LSR:{implied:74,zeroPage:70,zeroPageX:86,absolute:78,absoluteX:94},NOP:{implied:234},ORA:{immediate:9,zeroPage:5,zeroPageX:21,absolute:13,absoluteX:29,absoluteY:25,indirectX:1,indirectY:17},TAX:{implied:170},TXA:{implied:138},DEX:{implied:202},INX:{implied:232},TAY:{implied:168},TYA:{implied:152},DEY:{implied:136},INY:{implied:200},ROL:{implied:42,zeroPage:38,zeroPageX:54,absolute:46,absoluteX:62},ROR:{implied:106,zeroPage:102,zeroPageX:118,absolute:110,absoluteX:126},RTI:{implied:64},RTS:{implied:96},SBC:{immediate:233,zeroPage:229,zeroPageX:245,absolute:237,absoluteX:253,absoluteY:249,indirectX:225,indirectY:241},STA:{zeroPage:133,zeroPageX:149,absolute:141,absoluteX:157,absoluteY:153,indirectX:129,indirectY:145},TXS:{implied:154},TSX:{implied:186},PHA:{implied:72},PLA:{implied:104},PHP:{implied:8},PLP:{implied:40},STX:{zeroPage:134,zeroPageY:150,absolute:142},STY:{zeroPage:132,zeroPageY:148,absolute:140}},generateAddressingModeName:function(e){var t=e[0],r=2===e.length?e[1]:null,s=new Array,a="none";if(null==r&&"implied"in this.instructionSet[t])a="implied";else if(null!=r&&r.match(/^#\$[A-Fa-f0-9]{2}$/)&&"immediate"in this.instructionSet[t])s.push(parseInt(r.substr(2,2),16)),a="immediate";else if(null!=r&&r.match(/^\$[A-Fa-f0-9]{2}$/)&&"zeroPage"in this.instructionSet[t])s.push(parseInt(r.substr(1,2),16)),a="zeroPage";else if(null!=r&&r.match(/^\$[A-Fa-f0-9]{2},(X|x)$/)&&"zeroPageX"in this.instructionSet[t])s.push(parseInt(r.substr(1,2),16)),a="zeroPageX";else if(null!=r&&r.match(/^\$[A-Fa-f0-9]{2},(Y|y)$/)&&"zeroPageY"in this.instructionSet[t])s.push(parseInt(r.substr(1,2),16)),a="zeroPageY";else if(null!=r&&r.match(/^\$[A-Fa-f0-9]{2}$/)&&"relative"in this.instructionSet[t])s.push(parseInt(r.substr(1,2),16)),a="relative";else if(null!=r&&r.match(/^\$[A-Fa-f0-9]{4}$/)&&"absolute"in this.instructionSet[t])s.push(parseInt(r.substr(3,2),16)),s.push(parseInt(r.substr(1,2),16)),a="absolute";else if(null!=r&&r.match(/^\$[A-Fa-f0-9]{4},(X|x)$/)&&"absoluteX"in this.instructionSet[t])s.push(parseInt(r.substr(3,2),16)),s.push(parseInt(r.substr(1,2),16)),a="absoluteX";else if(null!=r&&r.match(/^\$[A-Fa-f0-9]{4},(Y|y)$/)&&"absoluteY"in this.instructionSet[t])s.push(parseInt(r.substr(3,2),16)),s.push(parseInt(r.substr(1,2),16)),a="absoluteY";else if(null!=r&&r.match(/^\(\$[A-Fa-f0-9]{2},(X|x)\)$/)&&"indirectX"in this.instructionSet[t])s.push(parseInt(r.substr(2,2),16)),a="indirectX";else if(null!=r&&r.match(/^\(\$[A-Fa-f0-9]{2}\),(Y|y)$/)&&"indirectY"in this.instructionSet[t])s.push(parseInt(r.substr(2,2),16)),a="indirectY";else{if(!(null!=r&&r.match(/^\(\$[A-Fa-f0-9]{4}\)$/)&&"indirect"in this.instructionSet[t]))return!1;s.push(parseInt(r.substr(4,2),16)),s.push(parseInt(r.substr(2,2),16)),a="indirect"}return{r_hexArguments:s,r_addressingModeName:a}},decodeAsmInstr:function(e){if(e.match(/^[A-Za-z]{3}((\s.*)?)$/)){var t=e.split(" ",2);if(t[0]=t[0].toUpperCase(),!(t[0]in this.instructionSet))return"Nieznany mnemonik.";var r=this.generateAddressingModeName(t);if(r){var s=[this.instructionSet[t[0]][r.r_addressingModeName]];return s.concat(r.r_hexArguments)}return"Nieprawidłowa składnia instrukcji lub nieobsługiwany tryb adresowania."}return"Ogólny błąd składni."},isThreeByteInstr:function(e){return e.match(/^[A-Za-z]{3} \$[A-Fa-f0-9]{4}$/)||e.match(/^[A-Za-z]{3} \$[A-Fa-f-0-9]{4},(X|x)$/)||e.match(/^[A-Za-z]{3} [A-Za-z]{3} \$[A-Fa-f0-9]{4},(Y|y)$/)||e.match(/^[A-Za-z]{3} \(\$[A-Fa-f0-9]{4}\)$/)},isTwoByteInstr:function(e){return e.match(/^[A-Za-z]{3} #\$[A-Fa-f0-9]{2}$/)||e.match(/^[A-Za-z]{3} \$[A-Fa-f0-9]{2}$/)||e.match(/^[A-Za-z]{3} \$[A-Fa-f0-9]{2},(X|x)$/)||e.match(/^[A-Za-z]{3} \$[A-Fa-f0-9]{2},(Y|y)$/)||e.match(/^[A-Za-z]{3} \(\$[A-Fa-f0-9]{2},(X|x)\)$/)||e.match(/^[A-Za-z]{3} \(\$[A-Fa-f0-9]{2}\),(Y|y)$/)},isOneByteInstr:function(e){return e.match(/^[A-Za-z]{3}/)}};FLAG_CARRY=1,FLAG_ZERO=2,FLAG_INTR=4,FLAG_DECIMAL=8,FLAG_BREAK=16,FLAG_UNUSED=32,FLAG_OVERFLOW=64,FLAG_SIGN=128,SECOND_BYTE_INSTRUCTION=0,IMPLIED_ADDRESSING_INSTRUCTION=1,IMMEDIATE_ADDRESSING_INSTRUCTION=2,RELATIVE_ADDRESSING_INSTRUCTION=3,ABS_READ_INSTRUCTION=0,ABS_RMW_INSTRUCTION=1,ABS_WRITE_INSTRUCTION=2,ZP_READ_INSTRUCTION=3,ZP_RMW_INSTRUCTION=4,ZP_WRITE_INSTRUCTION=5,ZPX_READ_INSTRUCTION=6,ZPX_RMW_INSTRUCTION=7,ZPX_WRITE_INSTRUCTION=8,ZPY_READ_INSTRUCTION=9,ZPY_WRITE_INSTRUCTION=10,ABSX_READ_INSTRUCTION=11,ABSX_RMW_INSTRUCTION=12,ABSX_WRITE_INSTRUCTION=13,ABSY_READ_INSTRUCTION=14,ABSY_WRITE_INSTRUCTION=15,REL_INSTRUCTION=16,INDX_READ_INSTRUCTION=17,INDX_WRITE_INSTRUCTION=18,INDY_READ_INSTRUCTION=19,INDY_WRITE_INSTRUCTION=20,ABS_IND_INSTRUCTION=21;for(var opcodes=[],i=0;i<255;++i)opcodes.push(new Opcode);fillOpcodeMnemonics(opcodes),fillOpcodeAddressingModes(opcodes),fillOpcodeCategories(opcodes),fillOpcodeLengths(opcodes);var cpu={currentCycle:0,currentOpcode:0,mem:new Array,registers:{a:0,x:0,y:0,flags:0,pc:0,sp:255},buf1:0,effective:0,indirectAddress:0,validEffective:0,pageBoundaryCrossed:!1,branch:!1,initializeMemory(e){for(var t=0;t<e;t++)t>=1536&&t<2048?t%2==0?cpu.mem.push(0):cpu.mem.push(7):cpu.mem.push(Math.floor(255*Math.random())+0)},reset(){cpu.setProgramCounter(cpu.getMem(65532)+16*cpu.getMem(65533)),cpu.currentCycle=0,cpu.registers.a=cpu.registers.x=cpu.registers.y=0,cpu.registers.sp=255,cpu.setFlags(FLAG_UNUSED|FLAG_BREAK),reactions.updateProgramCounterWithoutHighlighting(cpu.registers.pc),reactions.set8BitRegValue("A",0),reactions.set8BitRegValue("X",0),reactions.set8BitRegValue("Y",0),reactions.set8BitRegValue("SP",255),reactions.highlightLatch(0),reactions.selectComponentAndSetValue(cpuShapes.dataBuffer,0),reactions.resetInterface()},getMem(e){var t=cpu.mem[val16(e)];return reactions.highlightLatch(t),reactions.highlightInternalDataBus(),t},set8BitReg(e,t){cpu.registers[e]=t,reactions.set8BitRegValue(e.toUpperCase(),t)},set8BitRegAndSZflags(e,t){cpu.set8BitReg(e,t),cpu.setZeroAndSignFlag(t)},setProgramCounter(e){cpu.registers.pc=e,reactions.set16BitRegValue("PC",e)},setMem(e,t){var r=val16(e);cpu.mem[r]=t,reactions.highlightInternalDataBus(),reactions.setMemory(r,t)},setZeroAndSignFlag(e){0==e?cpu.registers.flags|=FLAG_ZERO:cpu.registers.flags&=~FLAG_ZERO,128==(128&e)?cpu.registers.flags|=FLAG_SIGN:cpu.registers.flags&=~FLAG_SIGN,reactions.setFlagValue("N",(cpu.registers.flags&FLAG_SIGN)==FLAG_SIGN?1:0),reactions.setFlagValue("Z",(cpu.registers.flags&FLAG_ZERO)==FLAG_ZERO?1:0)},setFlags(e){cpu.registers.flags=48|e,reactions.setFlagValue("N",(cpu.registers.flags&FLAG_SIGN)==FLAG_SIGN?1:0),reactions.setFlagValue("V",(cpu.registers.flags&FLAG_OVERFLOW)==FLAG_OVERFLOW?1:0),reactions.setFlagValue("D",(cpu.registers.flags&FLAG_DECIMAL)==FLAG_DECIMAL?1:0),reactions.setFlagValue("I",(cpu.registers.flags&FLAG_INTR)==FLAG_INTR?1:0),reactions.setFlagValue("Z",(cpu.registers.flags&FLAG_ZERO)==FLAG_ZERO?1:0),reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0)},addWithCarry(e){var t=u2_8BitNumber(cpu.registers.a),r=u2_8BitNumber(e),s=(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0;t+r+s<-128||t+r+s>127?cpu.registers.flags|=FLAG_OVERFLOW:cpu.registers.flags&=~FLAG_OVERFLOW,reactions.setFlagValue("V",(cpu.registers.flags&FLAG_OVERFLOW)==FLAG_OVERFLOW?1:0),cpu.registers.a+e+s>255?cpu.registers.flags|=FLAG_CARRY:cpu.registers.flags&=~FLAG_CARRY,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),reactions.highlightInternalDataBus(),cpu.set8BitRegAndSZflags("a",val8(cpu.registers.a+e+s))},subtractWithCarry(e){var t=u2_8BitNumber(cpu.registers.a),r=u2_8BitNumber(e),s=~cpu.registers.flags&FLAG_CARRY;t-r-s<-128||t-r-s>127?cpu.registers.flags|=FLAG_OVERFLOW:cpu.registers.flags&=~FLAG_OVERFLOW,cpu.registers.a-e-s>0?cpu.registers.flags|=FLAG_CARRY:cpu.registers.flags&=~FLAG_CARRY,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),reactions.setFlagValue("V",(cpu.registers.flags&FLAG_OVERFLOW)==FLAG_OVERFLOW?1:0),reactions.highlightInternalDataBus(),cpu.set8BitRegAndSZflags("a",val8(cpu.registers.a-e-s))},compare(e,t){e<t?cpu.registers.flags=(cpu.registers.flags|FLAG_SIGN)&~FLAG_ZERO&~FLAG_CARRY:e==t?cpu.registers.flags=cpu.registers.flags&~FLAG_SIGN|FLAG_ZERO|FLAG_CARRY:e>t&&(cpu.registers.flags=cpu.registers.flags&~FLAG_SIGN&~FLAG_ZERO|FLAG_CARRY),reactions.setFlagValue("N",(cpu.registers.flags&FLAG_SIGN)==FLAG_SIGN?1:0),reactions.setFlagValue("Z",(cpu.registers.flags&FLAG_ZERO)==FLAG_ZERO?1:0),reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),reactions.highlightInternalDataBus()},bitTest(e){cpu.registers.flags=0;var t=cpu.registers.flags&~(FLAG_ZERO|FLAG_SIGN|FLAG_OVERFLOW);0==(e&cpu.registers.a)&&(t|=FLAG_ZERO),cpu.registers.flags|=t|(64==(64&e)?FLAG_OVERFLOW:0)|(128==(128&e)?FLAG_SIGN:0),reactions.setFlagValue("Z",(cpu.registers.flags&FLAG_ZERO)==FLAG_ZERO?1:0),reactions.setFlagValue("N",(cpu.registers.flags&FLAG_SIGN)==FLAG_SIGN?1:0),reactions.setFlagValue("V",(cpu.registers.flags&FLAG_OVERFLOW)==FLAG_OVERFLOW?1:0),reactions.highlightInternalDataBus()},rotateAccumRight(){var e=cpu.registers.flags&FLAG_CARRY;cpu.set8BitRegAndSZflags("a",val8(cpu.registers.a>>1|(0!=e)<<7)),cpu.registers.flags=cpu.registers.flags&~FLAG_CARRY|1&cpu.registers.a,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),reactions.highlightInternalDataBus()},rotateBufRight(){var e=cpu.registers.flags&FLAG_CARRY;cpu.buf1=val8(cpu.buf1>>1|(0!=e)<<7),cpu.registers.flags=cpu.registers.flags&~FLAG_CARRY|1&cpu.buf1,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),cpu.setZeroAndSignFlag(cpu.buf1)},rotateAccumLeft(){var e=cpu.registers.flags&FLAG_CARRY;cpu.set8BitRegAndSZflags("a",val8(cpu.registers.a<<1|0!=e)),cpu.registers.flags=cpu.registers.flags&~FLAG_CARRY|(128&cpu.registers.a)>>7,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),reactions.highlightInternalDataBus()},rotateBufLeft(){var e=cpu.registers.flags&FLAG_CARRY;cpu.buf1=val8(cpu.buf1<<1|0!=e),cpu.registers.flags=cpu.registers.flags&~FLAG_CARRY|(128&cpu.buf1)>>7,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),cpu.setZeroAndSignFlag(cpu.buf1)},accumLogicalShiftRight(){cpu.registers.flags=cpu.registers.flags&~FLAG_CARRY|1&cpu.registers.a,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),cpu.set8BitRegAndSZflags("a",val8(cpu.registers.a>>1&127)),reactions.highlightInternalDataBus()},bufLogicalShiftRight(){cpu.registers.flags=cpu.registers.flags&~FLAG_CARRY|1&cpu.buf1,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),cpu.buf1=val8(cpu.buf1>>1&127),cpu.setZeroAndSignFlag(cpu.buf1)},accumArithmeticShiftLeft(){cpu.registers.flags=cpu.registers.flags&~FLAG_CARRY|(128&cpu.registers.a)>>7,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),cpu.set8BitRegAndSZflags("a",val8(cpu.registers.a<<1&254)),reactions.highlightInternalDataBus()},bufArithmeticShiftLeft(){cpu.registers.flags=cpu.registers.flags&~FLAG_CARRY|(128&cpu.buf1)>>7,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0),cpu.buf1=val8(cpu.buf1<<1&254),cpu.setZeroAndSignFlag(cpu.buf1)},readFunctions(e){switch(cpu.currentOpcode){case e[0]:cpu.set8BitRegAndSZflags("a",cpu.getMem(cpu.effective));break;case e[1]:cpu.set8BitRegAndSZflags("x",cpu.getMem(cpu.effective));break;case e[2]:cpu.set8BitRegAndSZflags("y",cpu.getMem(cpu.effective));break;case e[3]:cpu.set8BitRegAndSZflags("a",cpu.registers.a&cpu.getMem(cpu.effective));break;case e[4]:cpu.set8BitRegAndSZflags("a",cpu.registers.a|cpu.getMem(cpu.effective));break;case e[5]:cpu.set8BitRegAndSZflags("a",cpu.registers.a^cpu.getMem(cpu.effective));break;case e[6]:cpu.addWithCarry(cpu.getMem(cpu.effective));break;case e[7]:cpu.subtractWithCarry(cpu.getMem(cpu.effective));break;case e[8]:cpu.compare(cpu.registers.a,cpu.getMem(cpu.effective));break;case e[9]:cpu.compare(cpu.registers.x,cpu.getMem(cpu.effective));break;case e[10]:cpu.compare(cpu.registers.y,cpu.getMem(cpu.effective));break;case e[11]:cpu.bitTest(cpu.getMem(cpu.effective))}reactions.highlightAlu(),cpu.pageBoundaryCrossed||(cpu.currentCycle=-1)},readModifyWriteFunctions(e){switch(cpu.currentOpcode){case e[0]:cpu.bufArithmeticShiftLeft();break;case e[1]:cpu.bufLogicalShiftRight();break;case e[2]:cpu.rotateBufLeft();break;case e[3]:cpu.rotateBufRight();break;case e[4]:cpu.buf1=val8(cpu.buf1+1),cpu.setZeroAndSignFlag(cpu.buf1);break;case e[5]:cpu.buf1=val8(cpu.buf1-1),cpu.setZeroAndSignFlag(cpu.buf1)}reactions.highlightAlu()},writeFunctions(e){switch(cpu.currentOpcode){case e[0]:cpu.setMem(cpu.effective,cpu.registers.a);break;case e[1]:cpu.setMem(cpu.effective,cpu.registers.x);break;case e[2]:cpu.setMem(cpu.effective,cpu.registers.y)}reactions.highlightAlu(),cpu.currentCycle=-1},writeFromBufToMemory(){cpu.setMem(cpu.effective,cpu.buf1),reactions.highlightAlu(),cpu.currentCycle=-1},checkBoundaryCrossingAndEvalEffective(e){cpu.validEffective=val16((cpu.getMem(cpu.registers.pc)<<8|cpu.buf1)+e),cpu.effective=val16(cpu.buf1+e&255+(cpu.getMem(cpu.registers.pc)<<8)),cpu.buf1+e>255?cpu.pageBoundaryCrossed=!0:cpu.effective=cpu.validEffective,cpu.setProgramCounter(val16(cpu.registers.pc+1)),reactions.highlightAlu()},checkBranch(){switch(cpu.currentOpcode){case 16:branch=(cpu.registers.flags&FLAG_SIGN)!=FLAG_SIGN;break;case 48:branch=(cpu.registers.flags&FLAG_SIGN)==FLAG_SIGN;break;case 80:branch=(cpu.registers.flags&FLAG_OVERFLOW)!=FLAG_OVERFLOW;break;case 112:branch=(cpu.registers.flags&FLAG_OVERFLOW)==FLAG_OVERFLOW;break;case 144:branch=(cpu.registers.flags&FLAG_CARRY)!=FLAG_CARRY;break;case 176:branch=(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY;break;case 208:branch=(cpu.registers.flags&FLAG_ZERO)!=FLAG_ZERO;break;case 240:branch=(cpu.registers.flags&FLAG_ZERO)==FLAG_ZERO}branch||(cpu.currentCycle=-1)},evalStackPeekAddr:()=>256+cpu.registers.sp,interrupt(){ProgramControl.break(),reactions.resetInterface()},tick(){switch(reactions.deselectComponents(),reactions.highlightDecoder(),reactions.updateCycleNumber(cpu.currentCycle+1),cpu.currentCycle){case 0:cpu.currentOpcode=cpu.getMem(cpu.registers.pc),reactions.highlightExecutedInstructionCell(cpu.registers.pc),reactions.updateInstructionIllustration(opcodes[cpu.currentOpcode].mnemonic.imageName),reactions.updateAddressingModeIllustration(opcodes[cpu.currentOpcode].addressingMode.imageName),reactions.updateAsmInstructionLine(opcodes[cpu.currentOpcode],cpu.mem,cpu.registers.pc),reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc),reactions.highlightInstrReg(),cpu.setProgramCounter(val16(cpu.registers.pc+1));break;case 1:switch(opcodes[cpu.currentOpcode].firstCategory){case SECOND_BYTE_INSTRUCTION:cpu.buf1=cpu.getMem(cpu.registers.pc),cpu.setProgramCounter(val16(cpu.registers.pc+1));break;case IMPLIED_ADDRESSING_INSTRUCTION:switch(cpu.currentOpcode){case 0:cpu.setProgramCounter(val16(cpu.registers.pc+1));break;case 248:cpu.registers.flags|=FLAG_DECIMAL,reactions.setFlagValue("D",(cpu.registers.flags&FLAG_DECIMAL)==FLAG_DECIMAL?1:0);break;case 216:cpu.registers.flags&=~FLAG_DECIMAL,reactions.setFlagValue("D",(cpu.registers.flags&FLAG_DECIMAL)==FLAG_DECIMAL?1:0);break;case 184:cpu.registers.flags&=~FLAG_OVERFLOW,reactions.setFlagValue("V",(cpu.registers.flags&FLAG_OVERFLOW)==FLAG_OVERFLOW?1:0);break;case 120:cpu.registers.flags|=FLAG_INTR,reactions.setFlagValue("I",(cpu.registers.flags&FLAG_INTR)==FLAG_INTR?1:0);break;case 88:cpu.registers.flags&=~FLAG_INTR,reactions.setFlagValue("I",(cpu.registers.flags&FLAG_INTR)==FLAG_INTR?1:0);break;case 56:cpu.registers.flags|=FLAG_CARRY,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0);break;case 24:cpu.registers.flags&=~FLAG_CARRY,reactions.setFlagValue("C",(cpu.registers.flags&FLAG_CARRY)==FLAG_CARRY?1:0);break;case 232:cpu.set8BitRegAndSZflags("x",val8(cpu.registers.x+1)),reactions.highlightInternalDataBus();break;case 202:cpu.set8BitRegAndSZflags("x",val8(cpu.registers.x-1)),reactions.highlightInternalDataBus();break;case 200:cpu.set8BitRegAndSZflags("y",val8(cpu.registers.y+1)),reactions.highlightInternalDataBus();break;case 136:cpu.set8BitRegAndSZflags("y",val8(cpu.registers.y-1)),reactions.highlightInternalDataBus();break;case 186:cpu.set8BitRegAndSZflags("x",cpu.registers.sp),reactions.highlightInternalDataBus();break;case 154:cpu.set8BitReg("sp",cpu.registers.x),reactions.highlightInternalDataBus();break;case 170:cpu.set8BitRegAndSZflags("x",cpu.registers.a),reactions.highlightInternalDataBus();break;case 138:cpu.set8BitRegAndSZflags("a",cpu.registers.x),reactions.highlightInternalDataBus();break;case 168:cpu.set8BitRegAndSZflags("y",cpu.registers.a),reactions.highlightInternalDataBus();break;case 152:cpu.set8BitRegAndSZflags("a",cpu.registers.y),reactions.highlightInternalDataBus();break;case 106:cpu.rotateAccumRight();break;case 42:cpu.rotateAccumLeft();break;case 74:cpu.accumLogicalShiftRight();break;case 10:cpu.accumArithmeticShiftLeft()}cpu.currentCycle=-1;break;case IMMEDIATE_ADDRESSING_INSTRUCTION:switch(cpu.currentOpcode){case 169:cpu.set8BitRegAndSZflags("a",cpu.getMem(cpu.registers.pc));break;case 162:cpu.set8BitRegAndSZflags("x",cpu.getMem(cpu.registers.pc));break;case 160:cpu.set8BitRegAndSZflags("y",cpu.getMem(cpu.registers.pc));break;case 105:cpu.addWithCarry(cpu.getMem(cpu.registers.pc));break;case 233:cpu.subtractWithCarry(cpu.getMem(cpu.registers.pc));break;case 41:cpu.set8BitRegAndSZflags("a",cpu.registers.a&cpu.getMem(cpu.registers.pc));break;case 9:cpu.set8BitRegAndSZflags("a",cpu.registers.a|cpu.getMem(cpu.registers.pc));break;case 73:cpu.set8BitRegAndSZflags("a",cpu.registers.a^cpu.getMem(cpu.registers.pc));break;case 201:cpu.compare(cpu.registers.a,cpu.getMem(cpu.registers.pc));break;case 224:cpu.compare(cpu.registers.x,cpu.getMem(cpu.registers.pc));break;case 192:cpu.compare(cpu.registers.y,cpu.getMem(cpu.registers.pc))}cpu.setProgramCounter(val16(cpu.registers.pc+1)),cpu.currentCycle=-1;break;case RELATIVE_ADDRESSING_INSTRUCTION:cpu.buf1=cpu.getMem(cpu.registers.pc),cpu.setProgramCounter(val16(cpu.registers.pc+1)),cpu.checkBranch()}reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc);break;case 2:switch(opcodes[cpu.currentOpcode].secondCategory){case ABS_READ_INSTRUCTION:case ABS_RMW_INSTRUCTION:case ABS_WRITE_INSTRUCTION:cpu.effective=cpu.getMem(cpu.registers.pc)<<8|cpu.buf1,cpu.setProgramCounter(val16(cpu.registers.pc+1)),reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc),reactions.highlightAlu();break;case ZP_READ_INSTRUCTION:cpu.effective=cpu.buf1,cpu.readFunctions([165,166,164,37,5,69,101,229,197,228,196,36]);break;case ZP_RMW_INSTRUCTION:cpu.effective=cpu.buf1,cpu.buf1=cpu.getMem(cpu.effective),reactions.highlightAlu();break;case ZP_WRITE_INSTRUCTION:cpu.effective=cpu.buf1,cpu.writeFunctions([133,134,132]),reactions.highlightAlu();break;case ZPX_READ_INSTRUCTION:case ZPX_RMW_INSTRUCTION:case ZPX_WRITE_INSTRUCTION:cpu.effective=val8(cpu.buf1+cpu.registers.x),reactions.highlightAlu();break;case ZPY_READ_INSTRUCTION:case ZPY_WRITE_INSTRUCTION:cpu.effective=val8(cpu.buf1+cpu.registers.y),reactions.highlightAlu();break;case ABSX_READ_INSTRUCTION:case ABSX_RMW_INSTRUCTION:case ABSX_WRITE_INSTRUCTION:cpu.checkBoundaryCrossingAndEvalEffective(cpu.registers.x),reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc);break;case ABSY_READ_INSTRUCTION:case ABSY_WRITE_INSTRUCTION:cpu.checkBoundaryCrossingAndEvalEffective(cpu.registers.y);break;case REL_INSTRUCTION:var e=128==(128&cpu.buf1)?(127&cpu.buf1)-128:cpu.buf1;(255&cpu.registers.pc)+e>255?cpu.pageBoundaryCrossed=!0:cpu.currentCycle=-1,cpu.setProgramCounter(val16(65280&cpu.registers.pc|cpu.registers.pc+e&255)),
reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc);break;case INDX_READ_INSTRUCTION:case INDX_WRITE_INSTRUCTION:cpu.indirectAddress=val8(cpu.getMem(cpu.buf1+cpu.registers.x)),reactions.highlightAlu();break;case INDY_READ_INSTRUCTION:case INDY_WRITE_INSTRUCTION:cpu.effective=val8(cpu.getMem(cpu.buf1)),reactions.highlightAlu();break;case ABS_IND_INSTRUCTION:cpu.indirectAddress=cpu.getMem(cpu.registers.pc)<<8|cpu.buf1,cpu.setProgramCounter(val16(cpu.registers.pc+1)),reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc),reactions.highlightAlu()}switch(cpu.currentOpcode){case 0:cpu.setMem(cpu.evalStackPeekAddr(),(65280&cpu.registers.pc)>>8),cpu.set8BitReg("sp",val8(cpu.registers.sp-1)),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 64:case 96:cpu.set8BitReg("sp",val8(cpu.registers.sp+1)),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 72:cpu.setMem(cpu.evalStackPeekAddr(),cpu.registers.a),cpu.set8BitReg("sp",val8(cpu.registers.sp-1)),reactions.highlightAddressBus(1,cpu.registers.sp),cpu.currentCycle=-1;break;case 8:cpu.setMem(cpu.evalStackPeekAddr(),cpu.registers.flags),cpu.set8BitReg("sp",val8(cpu.registers.sp-1)),reactions.highlightAddressBus(1,cpu.registers.sp),cpu.currentCycle=-1;break;case 104:case 40:cpu.set8BitReg("sp",val8(cpu.registers.sp+1)),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 76:cpu.setProgramCounter(cpu.buf1|cpu.getMem(cpu.registers.pc)<<8),reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc),cpu.currentCycle=-1}break;case 3:switch(opcodes[cpu.currentOpcode].secondCategory){case ABS_READ_INSTRUCTION:cpu.readFunctions([173,174,172,45,13,77,109,237,205,236,204,44]);break;case ABS_RMW_INSTRUCTION:case ZPX_RMW_INSTRUCTION:cpu.buf1=cpu.getMem(cpu.effective),reactions.highlightAlu();break;case ABS_WRITE_INSTRUCTION:cpu.writeFunctions([141,142,140]);break;case ZP_RMW_INSTRUCTION:cpu.readModifyWriteFunctions([6,70,38,102,230,198]);break;case ZPX_READ_INSTRUCTION:case ZPY_READ_INSTRUCTION:cpu.readFunctions([181,182,180,85,53,21,117,245,213,-1,-1,-1]);break;case ZPX_WRITE_INSTRUCTION:case ZPY_WRITE_INSTRUCTION:cpu.writeFunctions([149,150,148]);break;case ABSX_READ_INSTRUCTION:cpu.readFunctions([189,-1,188,61,29,93,125,253,221,-1,-1,-1]);break;case ABSY_READ_INSTRUCTION:cpu.readFunctions([185,190,-1,57,25,89,121,249,217,-1,-1,-1]);break;case ABSX_RMW_INSTRUCTION:case ABSX_WRITE_INSTRUCTION:case ABSY_WRITE_INSTRUCTION:cpu.buf1=cpu.getMem(cpu.effective),reactions.highlightAlu();break;case REL_INSTRUCTION:if(cpu.pageBoundaryCrossed){var t=cpu.buf1>=128?-256:256;cpu.setProgramCounter(val16(cpu.registers.pc+t)),cpu.pageBoundaryCrossed=!1,reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc),cpu.currentCycle=-1}break;case INDX_READ_INSTRUCTION:case INDX_WRITE_INSTRUCTION:cpu.effective=cpu.indirectAddress,cpu.indirectAddress=val8(cpu.getMem(cpu.buf1+cpu.registers.x+1)),reactions.highlightAlu();break;case INDY_READ_INSTRUCTION:cpu.validEffective=(cpu.getMem(cpu.buf1+1)<<8)+cpu.effective+cpu.registers.y,cpu.effective=val16(cpu.getMem(cpu.buf1)+cpu.registers.y&255+(cpu.getMem(cpu.buf1+1)<<8)),cpu.getMem(cpu.buf1)+cpu.registers.y>255?cpu.pageBoundaryCrossed=!0:cpu.effective=cpu.validEffective;break;case INDY_WRITE_INSTRUCTION:cpu.effective=(cpu.getMem(cpu.buf1+1)<<8)+cpu.effective+cpu.registers.y,reactions.highlightAlu();break;case ABS_IND_INSTRUCTION:cpu.buf1=cpu.getMem(cpu.indirectAddress),reactions.highlightAlu(),reactions.highlightLatch(cpu.buf1)}switch(cpu.currentOpcode){case 0:cpu.setMem(cpu.evalStackPeekAddr(),255&cpu.registers.pc),cpu.set8BitReg("sp",val8(cpu.registers.sp-1)),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 64:cpu.setFlags(cpu.getMem(cpu.evalStackPeekAddr())),cpu.set8BitReg("sp",val8(cpu.registers.sp+1)),reactions.highlightInternalDataBus(),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 96:cpu.setProgramCounter(65280&cpu.registers.pc|cpu.getMem(cpu.evalStackPeekAddr())),cpu.set8BitReg("sp",val8(cpu.registers.sp+1)),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 104:cpu.set8BitRegAndSZflags("a",cpu.getMem(cpu.evalStackPeekAddr())),reactions.highlightAddressBus(1,cpu.registers.sp),reactions.highlightInternalDataBus(),cpu.currentCycle=-1;break;case 40:cpu.setFlags(cpu.getMem(cpu.evalStackPeekAddr())),reactions.highlightAddressBus(1,cpu.registers.sp),reactions.highlightInternalDataBus(),cpu.currentCycle=-1;break;case 32:cpu.setMem(cpu.evalStackPeekAddr(),(65280&cpu.registers.pc)>>8),cpu.set8BitReg("sp",val8(cpu.registers.sp-1)),reactions.highlightAddressBus(1,cpu.registers.sp)}break;case 4:switch(opcodes[cpu.currentOpcode].secondCategory){case ABS_RMW_INSTRUCTION:cpu.readModifyWriteFunctions([14,78,46,110,238,206]);break;case ZP_RMW_INSTRUCTION:cpu.writeFromBufToMemory();break;case ZPX_RMW_INSTRUCTION:cpu.readModifyWriteFunctions([22,86,54,118,246,214]);break;case ABSX_READ_INSTRUCTION:case ABSY_READ_INSTRUCTION:cpu.effective=cpu.validEffective,cpu.readFunctions([189,190,188,61,29,93,125,253,221,-1,-1,-1]),cpu.pageBoundaryCrossed=!1,reactions.highlightAlu(),cpu.currentCycle=-1;break;case ABSX_RMW_INSTRUCTION:cpu.effective=cpu.validEffective,cpu.buf1=cpu.getMem(cpu.effective),reactions.highlightAlu();break;case ABSX_WRITE_INSTRUCTION:cpu.effective=cpu.validEffective,cpu.writeFunctions([157,-1,-1]),reactions.highlightAlu();break;case ABSY_WRITE_INSTRUCTION:cpu.effective=cpu.validEffective,cpu.writeFunctions([153,-1,-1]),reactions.highlightAlu();break;case INDX_READ_INSTRUCTION:case INDX_WRITE_INSTRUCTION:cpu.effective+=cpu.indirectAddress<<8,reactions.highlightAlu();break;case INDY_READ_INSTRUCTION:cpu.effective+cpu.registers.y>255&&(cpu.pageBoundaryCrossed=!0),cpu.readFunctions([177,-1,-1,49,17,81,113,241,209,-1,-1,-1]);break;case INDY_WRITE_INSTRUCTION:cpu.buf1=val8(cpu.getMem(cpu.effective)),reactions.highlightAlu();break;case ABS_IND_INSTRUCTION:cpu.setProgramCounter(cpu.getMem(cpu.indirectAddress+1)<<8|cpu.buf1),cpu.currentCycle=-1}switch(cpu.currentOpcode){case 0:cpu.setMem(cpu.evalStackPeekAddr(),cpu.registers.flags),cpu.set8BitReg("sp",val8(cpu.registers.sp-1)),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 64:cpu.setProgramCounter(65280&cpu.registers.pc|cpu.getMem(cpu.evalStackPeekAddr())),cpu.set8BitReg("sp",val8(cpu.registers.sp+1)),reactions.highlightInternalDataBus(),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 96:cpu.setProgramCounter(cpu.getMem(cpu.evalStackPeekAddr())<<8|255&cpu.registers.pc),reactions.highlightInternalDataBus(),reactions.highlightAddressBus(1,cpu.registers.sp);break;case 32:cpu.setMem(cpu.evalStackPeekAddr(),255&cpu.registers.pc),cpu.set8BitReg("sp",val8(cpu.registers.sp-1)),reactions.highlightAddressBus(1,cpu.registers.sp)}break;case 5:switch(opcodes[cpu.currentOpcode].secondCategory){case ABS_RMW_INSTRUCTION:case ZPX_RMW_INSTRUCTION:cpu.writeFromBufToMemory();break;case ABSX_RMW_INSTRUCTION:cpu.readModifyWriteFunctions([30,94,62,126,254,222]);break;case INDX_READ_INSTRUCTION:cpu.readFunctions([161,-1,-1,33,1,65,97,225,193,-1,-1,-1]);break;case INDX_WRITE_INSTRUCTION:cpu.writeFunctions([129,-1,-1]);break;case INDY_READ_INSTRUCTION:cpu.effective=cpu.validEffective,cpu.readFunctions([177,-1,-1,49,17,81,113,241,209,-1,-1,-1]),cpu.pageBoundaryCrossed=!1,reactions.highlightAlu(),cpu.currentCycle=-1;break;case INDY_WRITE_INSTRUCTION:cpu.writeFunctions([145,-1,-1])}switch(cpu.currentOpcode){case 0:cpu.setProgramCounter(65280&cpu.registers.pc|cpu.getMem(65534));break;case 64:cpu.setProgramCounter(255&cpu.registers.pc|cpu.getMem(cpu.evalStackPeekAddr())<<8),reactions.highlightInternalDataBus(),reactions.highlightAddressBus(1,cpu.registers.sp),cpu.currentCycle=-1;break;case 96:cpu.setProgramCounter(val16(cpu.registers.pc+1)),reactions.highlightAddressBus(cpu.registers.pc>>8,255&cpu.registers.pc),cpu.currentCycle=-1;break;case 32:cpu.setProgramCounter(cpu.getMem(cpu.registers.pc)<<8|cpu.buf1),reactions.highlightInternalDataBus(),cpu.currentCycle=-1}break;case 6:switch(opcodes[cpu.currentOpcode].secondCategory){case ABSX_RMW_INSTRUCTION:cpu.writeFromBufToMemory()}switch(cpu.currentOpcode){case 0:cpu.setProgramCounter(255&cpu.registers.pc|cpu.getMem(65535)<<8),setTimeout(cpu.interrupt,3e3),cpu.currentCycle=-1}}cpu.currentCycle++,reactions.refreshCpu()}},userInterface={switchButtonActivity(e,t){var r=$("#"+e);t?(r.removeProp("disabled"),r.removeClass("disabled-button")):(r.prop("disabled",!0),r.addClass("disabled-button"))},refreshRamTable(){var e=parseInt($("#rvi1").val(),16),t=parseInt($("#rvi2").val());isNaN(e)||isNaN(t)?$("#message").text("W co najmniej jednym polu wpisano nieprawidłową wartość."):($("#message").empty(),$("#ram-table-refresh-button").after('<i class="icon-spin6 animate-spin" id="loading-icon"></i>'),setTimeout(fillTable,50,65520&e,e+t-1&65520))},updateProgramCounter(){var e=$("#pc-input").val();reactions.updateProgramCounterWithoutHighlighting(e),cpu.registers.pc=parseInt(e,16)},CellEditor:{editCell(e){var t=String($(this).text().substr(1,2)),r=String(e.target.id).substr(4);$(this).html('<input type="text" id="inp'+r+'" value="'+t+'"/>'),$(this).off("dblclick"),$("#inp"+r).focus(),$("#inp"+r).blur(userInterface.CellEditor.switchToStillCell)},switchToStillCell(e){var t=parseInt($(this).val(),16),r=String(e.target.id).substr(3);if(!isNaN(t)&&t>=0&&t<=255){$(this).replaceWith("$"+addLeadingZeros(t.toString(16),2));var s=parseInt(r);cpu.mem[s]=t,simConsole.updateConsole(s,t)}else{$(this).replaceWith("$00");s=parseInt(r);cpu.mem[s]=0,simConsole.updateConsole(s,0)}$("#cell"+r).dblclick(userInterface.CellEditor.editCell)}},SourceCodeEditor:{preprocessCode(e){var t,r,s,a,c=new Array,u=new Array,n=0,o=new Array,p=!0;for(i=0;i<e.length;++i){if(t=e[i],r=t.indexOf(";"),t=t.substring(0,-1!=r?r:t.length),t=t.trim(),t.match(/\w{1,}:.*[^\s]$/)){var l=t.indexOf(":");if(s=t.substring(0,l),s in o){var g=n-o[s]-2;c[u[s]]=c[u[s]].replace(/ \w+$/g,"$"+g.toString(16))}else o[s]=n;t=t.substring(l+2),t=t.trim()}for(;-1!=t.indexOf(" ")&&t.indexOf(" ")!=t.lastIndexOf(" ");)t=t.substring(0,t.lastIndexOf(" "))+t.substring(t.lastIndexOf(" ")+1);if(t.match(/^(BPL|BMI|BVC|BVS|BCC|BCS|BNE|BEQ) \w+$/))if(s=t.split(" ",2)[1],s in o){g=val8(o[s]-n-2);t=t.replace(/\w+$/,"$"+g.toString(16))}else u[s]=i;if(assembler.isThreeByteInstr(t))n+=3;else if(assembler.isTwoByteInstr(t))n+=2;else{if(!assembler.isOneByteInstr(t)){a=i,p=!1;break}n++}c.push(t)}return p?{success:!0,instructions:c}:{success:!1,message:"Linia "+String(a+1)+": Błąd składniowy w instrukcji lub jej brak."}},processCode(){$("#message").empty(),reactions.deselectComponents(),userInterface.SourceDebugView.clearList();var e=$("#source-code").val().split(/\r\n|\r|\n/g),t=userInterface.SourceCodeEditor.preprocessCode(e);if(!t.success)return $("#message").text(t.message),!1;var r,s=cpu.registers.pc,a=s;for(i=0;i<t.instructions.length;++i){if(r=assembler.decodeAsmInstr(t.instructions[i]),!Array.isArray(r))return $("#message").text("Linia "+String(i+1)+": "+r),!1;for(j=0;j<r.length;++j)cpu.setMem(s,r[j]),++s;userInterface.SourceDebugView.addLineToDebugSec(a,e[i]),a=s,localStorage.setItem("asm-code",$("#source-code").val())}return!0}},SourceDebugView:{currentLineNumber:0,lastLineNumber:1,codeIndexes:{},clearList(){$("#loaded-source-code").empty(),this.lastLineNumber=1,this.codeIndexes={}},addLineToDebugSec(e,t){let r=$("#loaded-source-code"),s=addLeadingZeros(e.toString(16).toUpperCase(),4);r.append(`<li>${this.lastLineNumber} ($${s}) ${t}</li>`),this.codeIndexes[e]=this.lastLineNumber,this.lastLineNumber++},markCurrentInstruction(e){if(e in this.codeIndexes){let t=this.codeIndexes[e];$("#loaded-source-code li.current-statement").removeClass("current-statement"),$(`#loaded-source-code li:nth-child(${t})`).addClass("current-statement"),this.currentLineNumber=t}else this.unmarkCurrentInstruction()},unmarkCurrentInstruction(){$("#loaded-source-code li.current-statement").removeClass("current-statement"),this.currentLineNumber=0}}},additionalUtils={switchBackground(){$("body").css("background-color","101201255"==$("body").css("background-color").replace(/\D+/g,"")?"#222222":"#65C9FF")}};let ModalManager={beginnerMessageLocalStorageKey:"beginner",prepareBeginnerMessage(){null===localStorage.getItem(this.beginnerMessageLocalStorageKey)?($("#beginner-modal .modal-button:nth-child(1)").click(this.closeBeginnerModal),$("#beginner-modal .modal-button:nth-child(2)").click(this.goToTutorial),$(".modal-background").css("visibility","visible"),$("#beginner-modal").css("visibility","visible"),setTimeout(ModalManager.showBeginnerModal,1e3)):this.hideModalElements()},showBeginnerModal(){$(".modal-background").css("opacity",.5),$("#beginner-modal").addClass("active")},goToTutorial(){window.open("help/tutorials/tut1.html"),ModalManager.closeBeginnerModal()},closeBeginnerModal(){localStorage.setItem(ModalManager.beginnerMessageLocalStorageKey,!1),$(".modal-background").css("opacity",0),$("#beginner-modal").removeClass("active"),setTimeout(ModalManager.hideModalElements,1e3)},hideModalElements(){$(".modal-background").css("visibility","hidden"),$("#beginner-modal").css("visibility","hidden")}};var ProgramControl={EXECUTED_INSTRUCTION_CLASS_NAME:"executed-instruction",tickTimer:0,isRunning:!1,init(){var e=$("#start-button");return e.off("click"),e.html('<i class="icon-stop"></i> Reset'),e.attr("id","reset-button"),e.attr("title","Kończy wykonywanie programu i przywraca domyślny stan licznika"),e.click(ProgramControl.reset),userInterface.switchButtonActivity("pc-update-button",!1),userInterface.switchButtonActivity("load-button",!1),ProgramControl.isRunning=!0,!0},start(){ProgramControl.init()&&(ProgramControl.tick(),ProgramControl.tickTimer=setInterval(ProgramControl.tick,3e3))},step(){(ProgramControl.isRunning||ProgramControl.init())&&(userInterface.switchButtonActivity("continue-button",!0),clearInterval(ProgramControl.tickTimer),ProgramControl.tick())},continueProgram(){userInterface.switchButtonActivity("continue-button",!1),ProgramControl.tickTimer=setInterval(ProgramControl.tick,3e3)},tick(){0==cpu.currentCycle&&userInterface.SourceDebugView.markCurrentInstruction(cpu.registers.pc),cpu.tick()},break(){ProgramControl.isRunning=!1;var e=$("#reset-button");e.off("click"),e.html('<i class="icon-play"></i> Start'),e.attr("id","start-button"),e.attr("title","Rozpoczyna wykonywanie programu"),e.click(ProgramControl.start),userInterface.switchButtonActivity("continue-button",!1),userInterface.switchButtonActivity("pc-update-button",!0),userInterface.switchButtonActivity("load-button",!0),userInterface.SourceDebugView.unmarkCurrentInstruction(),clearInterval(ProgramControl.tickTimer)},reset(){ProgramControl.break(),cpu.reset()}},reactions={changedComponents:new Array,lastInstructionCellAddress:0,deselectComponents:function(){for(;reactions.changedComponents.length>0;)reactions.changedComponents.pop().clear()},selectComponent(e){e.isHighlighted()||(e.highlight(),reactions.changedComponents.push(e))},selectComponentAndSetValue(e,t){e.isHighlighted()||(e.setValue(t),reactions.changedComponents.push(e))},set8BitRegValue(e,t){reactions.selectComponentAndSetValue(cpuShapes.registers[e],t)},set16BitRegValue(e,t){reactions.selectComponentAndSetValue(cpuShapes.registers[e],t)},setFlagValue(e,t){reactions.selectComponent(cpuShapes.flags),reactions.selectComponentAndSetValue(cpuShapes.flag[e],t)},setMemory(e,t){reactions.selectComponentAndSetValue(memory.memoryCells[e],t),reactions.selectComponentAndSetValue(cpuShapes.dataBuffer,t),simConsole.updateConsole(e,t)},refreshCpu(){cpuShapes.refresh()},clearExecutedInstructionCell(){var e=$("#cell"+reactions.lastInstructionCellAddress);e.css("background-color","#f5f5f5"),e.css("color","#373737"),e.attr("title","$"+addLeadingZeros(reactions.lastInstructionCellAddress.toString(16),4).toUpperCase()),e.dblclick(userInterface.CellEditor.editCell)},highlightExecutedInstructionCell(e){reactions.clearExecutedInstructionCell(),reactions.lastInstructionCellAddress=e;var t=$("#cell"+e);t.css("background-color","aquamarine"),t.attr("title","Tu jest wykonywana instrukcja"),t.off("dblclick")},highlightComponents(){for(i=0;i<reactions.changedComponents.length;i++)reactions.changedComponents[i].highlight()},highlightEICAgain(){ProgramControl.isRunning&&reactions.highlightExecutedInstructionCell(reactions.lastInstructionCellAddress)},highlightDecoder(){reactions.selectComponent(cpuShapes.instructionDecoder)},highlightInstrReg(){reactions.selectComponent(cpuShapes.instructionRegister)},highlightAlu(){reactions.selectComponent(cpuShapes.alu)},highlightAddressBus(e,t){reactions.selectComponent(cpuShapes.internalADH),reactions.selectComponentAndSetValue(cpuShapes.adh,e),reactions.selectComponent(cpuShapes.internalADL),reactions.selectComponentAndSetValue(cpuShapes.adl,t)},highlightInternalDataBus(){reactions.selectComponent(cpuShapes.internalDataBus)},highlightLatch(e){reactions.selectComponentAndSetValue(cpuShapes.dataLatch,e)},updateCycleNumber(e){$("#cycle-number").text(e.toString())},updateAsmInstructionLine(e,t,r){var s="[Nieznany opkod]";switch(e.length){case 1:s=e.mnemonic.name;break;case 2:switch(e.addressingMode.name){case"immediate":s=e.mnemonic.name+" #$"+addLeadingZeros(t[val16(r+1)].toString(16),2);break;case"zero page":case"relative":s=e.mnemonic.name+" $"+addLeadingZeros(t[val16(r+1)].toString(16),2);break;case"zero page X":s=e.mnemonic.name+" $"+addLeadingZeros(t[val16(r+1)].toString(16),2)+", X";break;case"zero page Y":s=e.mnemonic.name+" $"+addLeadingZeros(t[val16(r+1)].toString(16),2)+", Y";break;case"indirect X":s=e.mnemonic.name+" ($"+addLeadingZeros(t[val16(r+1)].toString(16),2)+", X)";break;case"indirect Y":s=e.mnemonic.name+" ($"+addLeadingZeros(t[val16(r+1)].toString(16),2)+"), Y"}break;case 3:switch(e.addressingMode.name){case"absolute":s=e.mnemonic.name+" $"+addLeadingZeros(t[val16(r+2)].toString(16),2)+addLeadingZeros(t[val16(r+1)].toString(16),2);break;case"absolute X":s=e.mnemonic.name+" $"+addLeadingZeros(t[val16(r+2)].toString(16),2)+addLeadingZeros(t[val16(r+1)].toString(16),2)+", X";break;case"absolute Y":s=e.mnemonic.name+" $"+addLeadingZeros(t[val16(r+2)].toString(16),2)+addLeadingZeros(t[val16(r+1)].toString(16),2)+", Y";break;case"absolute indirect":s=e.mnemonic.name+" ($"+addLeadingZeros(t[val16(r+2)].toString(16),2)+addLeadingZeros(t[val16(r+1)].toString(16),2)+")"}}$("#asm-instr-sec").html(s)},updateProgramCounterWithoutHighlighting(e){cpuShapes.registers.PC.setValue(e),cpuShapes.registers.PC.clear(),cpuShapes.refresh()},updateInstructionIllustration(e){$("#asm-image").html('<img src="img/'+e+'" alt="'+e+'" />')},updateAddressingModeIllustration(e){$("#addressing-mode-image").html('<img src="img/'+e+'" alt="'+e+'" />')},resetInterface(){reactions.clearExecutedInstructionCell(),reactions.updateCycleNumber(0),$("#asm-instr-sec").empty(),reactions.updateInstructionIllustration("nic.png"),reactions.updateAddressingModeIllustration("nic.png"),reactions.deselectComponents(),cpuShapes.refresh()}},memory={memoryCells:new Array(65536),MemoryCell:function(e){this._address=e,this._highlighted=!1,this.setValue=function(e){$("#cell"+this._address).text("$"+addLeadingZeros(e.toString(16),2)),this.highlight()},this.highlight=function(){$("#cell"+this._address).css("color","red"),this._highlighted=!0},this.isHighlighted=function(){return this._highlighted},this.clear=function(){$("#cell"+this._address).css("color","#373737"),this._highlighted=!1}},init(){for(i=0;i<memory.memoryCells.length;++i)memory.memoryCells[i]=new memory.MemoryCell(i)}},cpuShapes={cpuCanvas:0,instructionDecoder:0,decToInstrRegThickArrow:0,instructionRegister:0,instrRegArrows:new Array(8),dataBufferArrows:new Array(16),dataBufferLabels:new Array(8),dataBuffer:0,dataLatch:0,registers:new Array,alu:0,stackPtrToIntrADLThickArrow:0,aluToIntrADLThickArrow:0,aluToIntrADHThickArrow:0,pcToIntrADLThickArrow:0,pcToIntrADHThickArrow:0,dlToIntrADLThickArrow:0,dlToIntrADHThickArrow:0,internalADL:0,internalADH:0,intrADLtoADLThickArrow:0,intrADHtoADHThickArrow:0,adl:0,adh:0,adlArrows:new Array(8),adlLabels:new Array(8),adhArrows:new Array(8),adhLabels:new Array(8),intrDataBusToYRegThickBothSidedArrow:0,intrDataBusToXRegThickBothSidedArrow:0,intrDataBusToStackPtrThickBothSidedArrow:0,intrDataBusToAluThickBothSidedArrow:0,intrDataBusToAccumThickBothSidedArrow:0,intrDataBusToPclThickBothSidedArrow:0,intrDataBusToPchThickBothSidedArrow:0,intrDataBusToDataLatchThickArrow:0,intrDataBusToDataBufferThickArrow:0,flagsToIntrDataBusThickArrow:0,internalDataBus:0,flags:0,flag:new Array,decToFlagsThickBothSidedArrow:0,decoderArrows:new Array(8),decThinArrow:0,thinLineProps:{originX:"center",originY:"top",stroke:"black"},createThinArrow:function(e,t,r,s){var a=new fabric.Line([0,0,0,r],cpuShapes.thinLineProps),c=new fabric.Triangle({originX:"center",originY:"center",width:9,height:7,top:r,left:0,flipY:!0,color:"black"}),i=new fabric.Group([a,c],{originX:"center",originY:"top",left:e,top:t,angle:s,hoverCursor:"default"});return i},ThinArrow:new fabric.util.createClass({initialize:function(e,t,r,s,a){this._obj=cpuShapes.createThinArrow(t,r,s,a),this._canvas=e,this._canvas.add(this._obj)}}),BrokenThinArrow:fabric.util.createClass({_createBrokenThinArrow:function(e,t,r,s,a){var c=cpuShapes.createThinArrow(e,t,r,0),i=new fabric.Line([e,t,e+s,t],cpuShapes.thinLineProps),u=new fabric.Line([e+s,t+1,e+s,t-a+1],cpuShapes.thinLineProps);return new fabric.Group([c,i,u],{originX:s>0?"right":"left",originY:"top",left:e+s,top:t,arrow:c,hoverCursor:"default"})},initialize:function(e,t,r,s,a,c){this._obj=this._createBrokenThinArrow(t,r,s,a,c),this._canvas=e,this._canvas.add(this._obj)}}),ThickArrow:fabric.util.createClass({_createThickArrow:function(e,t,r,s){const a=18;return new fabric.Polygon([{x:a/2+e,y:t},{x:e,y:7+t},{x:4+e,y:7+t},{x:4+e,y:7+t+r},{x:a-4+e,y:7+t+r},{x:a-4+e,y:7+t},{x:a+e,y:7+t}],{originX:"center",originY:"top",stroke:"black",strokeWidth:1,fill:"white",angle:s,hoverCursor:"default"})},initialize:function(e,t,r,s,a){this._obj=this._createThickArrow(t,r,s,a),this._canvas=e,this._canvas.add(this._obj)}}),ThickBothSidedArrow:fabric.util.createClass({_createThickBothSidedArrow:function(e,t,r,s){const a=18;return new fabric.Polygon([{x:a/2+e,y:t},{x:e,y:7+t},{x:4+e,y:7+t},{x:4+e,y:7+t+r},{x:e,y:7+t+r},{x:a/2+e,y:14+t+r},{x:a+e,y:7+t+r},{x:a-4+e,y:7+t+r},{x:a-4+e,y:7+t},{x:a+e,y:7+t}],{originX:"center",originY:"top",stroke:"black",strokeWidth:1,fill:"white",angle:s,hoverCursor:"default"})},initialize:function(e,t,r,s,a){this._obj=this._createThickBothSidedArrow(t,r,s,a),this._canvas=e,this._canvas.add(this._obj)}}),Register:fabric.util.createClass({_createRegister:function(e,t,r,s,a,c,i){var u=new fabric.Rect({width:r,height:s,stroke:"black",fill:"white",originX:"center",originY:"top",strokeWidth:1.5}),n=new fabric.Text(a,{fontFamily:"Arial",fontSize:c,textAlign:"center",originX:"center",originY:"top",top:6}),o=new fabric.Text("$"+addLeadingZeros(0,i),{fontFamily:"Arial",fontSize:25,textAlign:"center",originX:"center",originY:"top",top:25});return new fabric.Group([u,n,o],{left:e,top:t,text:n,value:o,rect:u,hoverCursor:"pointer"})},initialize:function(e,t,r,s,a,c,i,u,n){this._obj=this._createRegister(t,r,s,a,c,i,u),this._canvas=e,this._canvas.add(this._obj),this._zeros=u,this._highlighted=!1,this._obj.on("mousedown",()=>window.open(`help/glossary/glossary.html#${n}`,"_blank"))},highlight:function(){this._obj.rect.stroke="red",this._obj.text.setColor("red"),this._obj.value.setColor("red"),this._highlighted=!0},setValue:function(e){this._obj.value.setText("$"+addLeadingZeros(e.toString(16),this._zeros).toUpperCase()),this.highlight()},isHighlighted(){return this._highlighted},clear:function(){this._obj.rect.stroke="black",this._obj.text.setColor("black"),this._obj.value.setColor("black"),this._highlighted=!1}}),RectComponent:fabric.util.createClass({_createRectComponent:function(e,t,r,s,a,c){var i=new fabric.Rect({width:r,height:s,stroke:"black",fill:"white",originX:"center",originY:"center",strokeWidth:1.5}),u=new fabric.Text(a,{fontFamily:"Arial",fontSize:c,textAlign:"center",originX:"center",originY:"center"});return new fabric.Group([i,u],{left:e,top:t,text:u,rect:i,hoverCursor:"pointer"})},initialize:function(e,t,r,s,a,c,i,u){this._obj=this._createRectComponent(t,r,s,a,c,i),this._canvas=e,this._canvas.add(this._obj),this._obj.on("mousedown",()=>window.open(`help/glossary/glossary.html#${u}`,"_blank")),this._highlighted=!1},highlight:function(){this._obj.rect.stroke="red",this._obj.text.setColor("red"),this._highlighted=!0},isHighlighted(){return this._highlighted},clear:function(){this._obj.rect.stroke="black",this._obj.text.setColor("black"),this._highlighted=!1}}),BusRegister:fabric.util.createClass({_createRegister:function(e,t,r,s,a,c,i){var u=new fabric.Rect({width:r,height:s,stroke:"black",fill:"white",originX:"center",originY:"center",strokeWidth:1.5}),n=new fabric.Text(a,{fontFamily:"Arial",fontSize:c,textAlign:"center",originX:"center",originY:"center",left:-5}),o=new fabric.Text("$"+addLeadingZeros(0,i),{fontFamily:"Arial",fontSize:15,textAlign:"center",originX:"center",originY:"center",left:n.left+n.width+5});return new fabric.Group([u,n,o],{left:e,top:t,text:n,value:o,rect:u,hoverCursor:"pointer"})},initialize(e,t,r,s,a,c,i,u){this._obj=this._createRegister(t,r,s,a,c,i,u),this._canvas=e,this._canvas.add(this._obj),this._zeros=u,this._highlighted=!1,this._obj.on("mouseclick",()=>window.open("help/glossary/glossary.html#address-bus","_blank"))},setValue(e){this._obj.value.setText("$"+addLeadingZeros(e.toString(16),this._zeros).toUpperCase()),this.highlight()},highlight(){this._obj.rect.stroke="red",this._obj.text.setColor("red"),this._obj.value.setColor("red"),this._highlighted=!0},isHighlighted(){return this._highlighted},clear(){this._obj.rect.stroke="black",this._obj.text.setColor("black"),this._obj.value.setColor("black"),this._highlighted=!1}}),ALU:fabric.util.createClass({_createALU:function(e,t){var r=new fabric.Polygon([{x:0,y:54},{x:24,y:0},{x:47,y:0},{x:69,y:54},{x:46,y:54},{x:35,y:40},{x:24,y:54}],{stroke:"black",fill:"white",strokeWidth:1,originX:"left",originY:"top"}),s=new fabric.Text("ALU",{left:21,top:19,fontFamily:"Arial",fontSize:15,originX:"left",originY:"top"});return new fabric.Group([r,s],{left:e,top:t,text:s,shape:r,hoverCursor:"pointer"})},initialize(e,t,r){this._obj=this._createALU(t,r),this._canvas=e,this._canvas.add(this._obj),this._highlighted=!1,this._obj.on("mousedown",()=>window.open("help/glossary/glossary.html#alu","_blank"))},highlight(){this._obj.shape.stroke="red",this._obj.text.setColor("red"),this._highlighted=!0},isHighlighted(){return this._highlighted},clear(){this._obj.shape.stroke="black",this._obj.text.setColor("black"),this._highlighted=!1}}),Flag:fabric.util.createClass({_createFlag(e,t,r,s,a){var c={fill:"white",stroke:"black",strokeWidth:1,width:r,height:r,originX:"center",originY:"center"},i={fontFamily:"Arial",fontSize:15,originX:"center",originY:"center"},u=new fabric.Rect(c),n=new fabric.Rect(c),o=new fabric.Text(s,i),p=new fabric.Text(a,i),l=new fabric.Group([u,o],{left:0,top:0}),g=new fabric.Group([n,p],{left:0,top:u.width});return new fabric.Group([l,g],{left:e,top:t,originX:"left",originY:"top",text:o,value:p,hoverCursor:"pointer",rects:new fabric.Group([u,n])})},initialize(e,t,r,s,a,c){this._obj=this._createFlag(t,r,s,a,c),this._canvas=e,this._canvas.add(this._obj),this._highlighted=!1,this._obj.on("mousedown",()=>window.open("help/glossary/glossary.html#flag-register","_blank"))},setValue(e){this._obj.value.setText(e.toString()),this.highlight()},highlight(){this._obj.value.setColor("red"),this._obj.text.setColor("red"),this._obj.rects.setStroke("red"),this._highlighted=!0},isHighlighted(){return this._highlighted},clear(){this._obj.value.setColor("black"),this._obj.text.setColor("black"),this._obj.rects.setStroke("black"),this._highlighted=!1}}),createLabel:function(e,t,r,s){return new fabric.Text(s,{left:e,top:t,angle:r,fontFamily:"Arial",fontSize:8,originX:"center",originY:"center",hoverCursor:"default"})},initShapes(){for(cpuShapes.cpuCanvas=new fabric.Canvas("cpu-canv"),cpuShapes.instructionDecoder=new cpuShapes.RectComponent(cpuShapes.cpuCanvas,107,56,210,53,"DEKODER\nINSTRUKCJI",15,"instruction-decoder"),cpuShapes.decToInstrRegThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,318,69,183,-90),i=0,x=627,y=60,length=20;i<cpuShapes.instrRegArrows.length;++i,x+=7,y+=7,length+=7)cpuShapes.instrRegArrows[i]=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,x,y,length,90);for(i=0,x=627,y=194,length=20;i<8;++i,x+=7,y+=7,length+=7)cpuShapes.dataBufferArrows[i]=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,x,y,length,90),cpuShapes.dataBufferLabels[i]=cpuShapes.createLabel(x,19,-90,"DB"+i),cpuShapes.cpuCanvas.add(cpuShapes.dataBufferLabels[i]);for(i=8,x=627,y=194,length=162;i<16;++i,x+=7,y+=7,length+=7)cpuShapes.dataBufferArrows[i]=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,x,y,length,180);for(cpuShapes.dataBuffer=new cpuShapes.Register(cpuShapes.cpuCanvas,517,191,85,53,"BUFOR\nSZYNY DANYCH",10,2,"data-buffer"),cpuShapes.dataLatch=new cpuShapes.Register(cpuShapes.cpuCanvas,468,191,45,53,"IDL",17,2,"idl"),cpuShapes.registers.PC=new cpuShapes.Register(cpuShapes.cpuCanvas,369,191,92,53,"LICZNIK\nPROGRAMU",9,4,"program-counter"),cpuShapes.registers.A=new cpuShapes.Register(cpuShapes.cpuCanvas,297,191,61,53,"A",17,2,"accumulator"),cpuShapes.alu=new cpuShapes.ALU(cpuShapes.cpuCanvas,222,191),cpuShapes.registers.SP=new cpuShapes.Register(cpuShapes.cpuCanvas,154,191,61,53,"STOS",17,2,"stack-pointer"),cpuShapes.registers.SP.setValue(255),cpuShapes.registers.SP.clear(),cpuShapes.registers.X=new cpuShapes.Register(cpuShapes.cpuCanvas,81,191,61,53,"X",17,2,"x-register"),cpuShapes.registers.Y=new cpuShapes.Register(cpuShapes.cpuCanvas,9,191,61,53,"Y",17,2,"y-register"),cpuShapes.stackPtrToIntrADLThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,185,266,13,180),cpuShapes.aluToIntrADLThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,233,266,13,180),cpuShapes.aluToIntrADHThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,278,297,44,180),cpuShapes.pcToIntrADLThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,393,266,13,180),cpuShapes.pcToIntrADHThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,439,297,44,180),cpuShapes.dlToIntrADLThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,480,266,13,180),cpuShapes.dlToIntrADHThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,501,297,44,180),cpuShapes.internalADL=new cpuShapes.RectComponent(cpuShapes.cpuCanvas,8,266,594,13,"WEWNĘTRZNA ADL",10,"address-bus"),cpuShapes.internalADH=new cpuShapes.RectComponent(cpuShapes.cpuCanvas,210,297,392,13,"WEWNĘTRZNA ADH",10,"address-bus"),cpuShapes.intrADLtoADLThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,65,341,53,180),cpuShapes.intrADHtoADHThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,520,341,22,180),cpuShapes.adl=new cpuShapes.BusRegister(cpuShapes.cpuCanvas,8,341,280,38,"ADL",15,2),i=0,x=25;i<cpuShapes.adlArrows.length;++i,x+=35)cpuShapes.adlArrows[i]=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,x,379,23),cpuShapes.adlLabels[i]=cpuShapes.createLabel(x,410,0,"AB"+i),cpuShapes.cpuCanvas.add(cpuShapes.adlLabels[i]);for(cpuShapes.adh=new cpuShapes.BusRegister(cpuShapes.cpuCanvas,322,341,280,38,"ADH",15,2),i=0,x=339;i<cpuShapes.adlArrows.length;++i,x+=35)cpuShapes.adhArrows[i]=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,x,379,23),cpuShapes.adhLabels[i]=cpuShapes.createLabel(x,410,0,"AB"+(i+8)),cpuShapes.cpuCanvas.add(cpuShapes.adhLabels[i]);cpuShapes.intrDataBusToYRegThickBothSidedArrow=new cpuShapes.ThickBothSidedArrow(cpuShapes.cpuCanvas,23,163,13,0),cpuShapes.intrDataBusToXRegThickBothSidedArrow=new cpuShapes.ThickBothSidedArrow(cpuShapes.cpuCanvas,93,163,13,0),cpuShapes.intrDataBusToStackPtrThickBothSidedArrow=new cpuShapes.ThickBothSidedArrow(cpuShapes.cpuCanvas,166,163,13,0),
cpuShapes.intrDataBusToAluThickBothSidedArrow=new cpuShapes.ThickBothSidedArrow(cpuShapes.cpuCanvas,261,163,13,0),cpuShapes.intrDataBusToAccumThickBothSidedArrow=new cpuShapes.ThickBothSidedArrow(cpuShapes.cpuCanvas,345,163,13,0),cpuShapes.intrDataBusToPclThickBothSidedArrow=new cpuShapes.ThickBothSidedArrow(cpuShapes.cpuCanvas,410,163,13,0),cpuShapes.intrDataBusToPchThickBothSidedArrow=new cpuShapes.ThickBothSidedArrow(cpuShapes.cpuCanvas,440,163,13,0),cpuShapes.intrDataBusToDataLatchThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,496,191,21,180),cpuShapes.intrDataBusToDataBufferThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,590,191,21,180),cpuShapes.flagsToIntrDataBusThickArrow=new cpuShapes.ThickArrow(cpuShapes.cpuCanvas,400,135,5,0),cpuShapes.decToFlagsThickBothSidedArrow=new cpuShapes.ThickBothSidedArrow(cpuShapes.cpuCanvas,318,95,15,-90),cpuShapes.decoderArrows[0]=new cpuShapes.BrokenThinArrow(cpuShapes.cpuCanvas,55,110,53,61,26),cpuShapes.decoderArrows[1]=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,135,110,78,0),cpuShapes.decoderArrows[2]=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,206,110,78,0),cpuShapes.decoderArrows[3]=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,250,110,78,0),cpuShapes.decoderArrows[4]=new cpuShapes.BrokenThinArrow(cpuShapes.cpuCanvas,304,110,15,-32,64),cpuShapes.decoderArrows[5]=new cpuShapes.BrokenThinArrow(cpuShapes.cpuCanvas,380,110,19,-95,60),cpuShapes.decoderArrows[6]=new cpuShapes.BrokenThinArrow(cpuShapes.cpuCanvas,475,110,23,-175,56),cpuShapes.decoderArrows[6]=new cpuShapes.BrokenThinArrow(cpuShapes.cpuCanvas,566,80,21,-67,88),cpuShapes.decThinArrow=new cpuShapes.ThinArrow(cpuShapes.cpuCanvas,500,80,178,90),cpuShapes.flags=new cpuShapes.RectComponent(cpuShapes.cpuCanvas,348,82,143.5,16,"REJESTR STANU",12,"flag-register"),cpuShapes.flag.N=new cpuShapes.Flag(cpuShapes.cpuCanvas,348,98,18,"N","0"),cpuShapes.flag.V=new cpuShapes.Flag(cpuShapes.cpuCanvas,366,98,18,"V","0"),cpuShapes.flag["-"]=new cpuShapes.Flag(cpuShapes.cpuCanvas,384,98,18,"-","1"),cpuShapes.flag.B=new cpuShapes.Flag(cpuShapes.cpuCanvas,402,98,18,"B","1"),cpuShapes.flag.D=new cpuShapes.Flag(cpuShapes.cpuCanvas,420,98,18,"D","0"),cpuShapes.flag.I=new cpuShapes.Flag(cpuShapes.cpuCanvas,438,98,18,"I","0"),cpuShapes.flag.Z=new cpuShapes.Flag(cpuShapes.cpuCanvas,456,98,18,"Z","0"),cpuShapes.flag.C=new cpuShapes.Flag(cpuShapes.cpuCanvas,474,98,18,"C","0"),cpuShapes.internalDataBus=new cpuShapes.RectComponent(cpuShapes.cpuCanvas,8,148,594,13,"WEWNĘTRZNA SZYNA DANYCH",10,"data-bus"),cpuShapes.instructionRegister=new cpuShapes.RectComponent(cpuShapes.cpuCanvas,509,56,93,53,"REJESTR\nINSTRUKCJI",15,"instruction-register"),cpuShapes.cpuCanvas.selection=!1,cpuShapes.cpuCanvas.forEachObject(function(e){e.selectable=!1})},refresh(){cpuShapes.cpuCanvas.renderAll()}};$(document).ready(init);